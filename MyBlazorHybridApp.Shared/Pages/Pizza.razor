@page "/pizza"

@using System.Net.Http
@using System.Net.Http.Json
@using Microsoft.Extensions.DependencyInjection
@using Microsoft.Extensions.Http
@using MyBlazorHybridApp.Shared.Services
@using BlazingPizza
@inject IFormFactor FormFactor
@inject IHttpClientFactory HttpClientFactory

<h3>Today's Pizza Specials</h3>
<div class="main">
    <h1>Blazing Pizzas</h1>
    <ul class="pizza-cards">
        @if (specials != null)
        {
            @foreach (var special in specials)
            {
                <li style="background-image: url('@special.ImageUrl')">
                    <div class="pizza-info">
                        <span class="title">@special.Name</span>
                        @special.Description
                        <span class="price">@special.GetFormattedBasePrice()</span>
                    </div>
                </li>
            }
        }
    </ul>
</div>

@code {
    List<PizzaSpecial> specials = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var httpClient = HttpClientFactory.CreateClient("BackendApi");
            specials = await httpClient.GetFromJsonAsync<List<PizzaSpecial>>("api/Specials") ?? new();
        }
        catch (Exception ex)        
        {
            Console.WriteLine($"Error fetching pizza specials: {ex.Message}");
        }
    }
}

@* If you still get CS0246, ensure your project references the required NuGet package: *@
@* Microsoft.Extensions.Http *@
@* You can add it via NuGet Package Manager or by running: dotnet add package Microsoft.Extensions.Http *@